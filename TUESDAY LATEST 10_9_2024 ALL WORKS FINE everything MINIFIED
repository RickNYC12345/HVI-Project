local a="hello"local b=false;local c=false;local d=false;local e=0;local f=nil;local g=2000;collectgarbage("setpause",100)collectgarbage("setstepmul",500)MB.writeName("LUA_NO_WARN_TRUNCATION",1)MB.writeName("ASYNCH_ENABLE",0)MB.writeName("ASYNCH_TX_DIONUM",14)MB.writeName("ASYNCH_RX_DIONUM",15)MB.writeName("ASYNCH_BAUD",9600)MB.writeName("ASYNCH_RX_BUFFER_SIZE_BYTES",200)MB.writeName("ASYNCH_NUM_DATA_BITS",8)MB.writeName("ASYNCH_NUM_STOP_BITS",1)MB.writeName("ASYNCH_PARITY",0)MB.writeName("ASYNCH_ENABLE",1)local function h(a)local a=MB.R(a,3)if a==nil then return 0 end;return a end;local function i(a,b)MB.W(a,0,b)end;local function j(a,b)local c=LJ.Tick()while(LJ.Tick()-c)<b do if MB.R(a,0)==1 then return true end end;return false end;local function j(a,b)local c={}c[#c+1]=string.byte('#')c[#c+1]=b;for b=1,a:len()do c[#c+1]=string.byte(a:sub(b,b))end;c[#c+1]=string.byte('\n')MB.writeName("ASYNCH_NUM_BYTES_TX",#c)MB.writeNameArray("ASYNCH_DATA_TX",#c,c)MB.writeName("ASYNCH_TX_GO",1)LJ.IntervalConfig(1,1600)while LJ.CheckInterval(1)==0 do end end;local function k()return MB.R(2002,0)==1 end;local function l()return k()end;local function m()if k()then if f==nil then f=LJ.Tick()elseif LJ.Tick()-f>=g then d=true;i(2008,0)end else f=nil;d=false end;return d end;local function g()i(2013,1)return true end;local function n()return MB.R(2016,0)==1 end;local function o(a)return h(a)end;local function p()return h(4)end;local function h()local a=0;local b=5;local c=0;local d=250;local e=0.00;LJ.IntervalConfig(0,3600)local function f(a,b,e)return((a-b)/(e-b))*(d-c)end;while k()do LJ.IntervalConfig(2,100)while LJ.CheckInterval(2)==0 do end end;j("CLEAR_LCD",39)LJ.IntervalConfig(1,500)while LJ.CheckInterval(1)==0 do end;while not k()do e=f(o(0),a,b)if LJ.CheckInterval(0)then local a=string.format("%.3f",e).." PSI"j("CLEAR_LCD",39)LJ.IntervalConfig(1,100)while LJ.CheckInterval(1)==0 do end;j(a,39)end end;local a=string.format("%.3f",e)j("CLEAR_LCD",39)LJ.IntervalConfig(1,100)while LJ.CheckInterval(1)==0 do end;j(a,39)return e end;local function o(a)local b=p()local c=0;local d=5;local e=0;local f=250;local g=0.01;local function h(a,b,c)return((a-b)/(c-b))*(f-e)end;LJ.IntervalConfig(1,1000)while LJ.CheckInterval(1)==0 do end;local e=h(b,c,d)local a=a;local f=a-e;local j=math.abs(f)/a;local k=j>g;if not k then return true end;local l=false;while not l do b=p()e=h(b,c,d)f=a-e;j=math.abs(f)/a;k=j>g;if k then if f<0 then i(2008,0)i(2009,0)else i(2009,1)i(2008,1)end;while k do b=p()e=h(b,c,d)f=a-e;j=math.abs(f)/a;k=j>g;if j<=g then k=false end;LJ.IntervalConfig(2,500)while LJ.CheckInterval(2)==0 do end end end;if not k then i(2008,1)i(2009,0)LJ.IntervalConfig(2,1000)while LJ.CheckInterval(2)==0 do end;l=true end;LJ.IntervalConfig(2,500)while LJ.CheckInterval(2)==0 do end end;return true end;local function q(a,b)j("CLEAR_LCD",b)LJ.IntervalConfig(1,500)while LJ.CheckInterval(1)==0 do end;local a,c=a:match("([^\n]*)\n?(.*)")j(a,b)LJ.IntervalConfig(1,500)while LJ.CheckInterval(1)==0 do end;j("SET_CURSOR_SECOND_LINE",b)LJ.IntervalConfig(1,500)while LJ.CheckInterval(1)==0 do end;j(c,b)end;local r=false;local function s()q("*READY TO FIRE*",39)local function a(a)local b=0;local a=a*100000;while b<a do b=b+1 end end;MB.W(2011,0,1)a(3)MB.W(2011,0,0)a(3)local a=0;local b=5;local c=0;local d=250;local function e(a,b,e)return((a-b)/(e-b))*(d-c)end;local a=e(p(),a,b)local a=string.format("%.3f",a).." PSI"local b=true;while b do local c=MB.R(2003,0)if(c==1)and not r then LJ.IntervalConfig(1,500)while LJ.CheckInterval(1)==0 do end;j(a,39)r=true end;local a=MB.R(3000,1)if a~=0 then local a=a*0.0000000125;local c=0.050/a;local a="TOF="..string.format("%.9f",a).."\nSPD="..string.format("%.9f",c)q(a,32)b=false end;LJ.IntervalConfig(2,200)while LJ.CheckInterval(2)==0 do end end;if m()then i(2011,0)end end;local function j()if not k()then e=p()end end;while true do while not l()do LJ.IntervalConfig(1,1000)while LJ.CheckInterval(1)==0 do end end;LJ.IntervalConfig(5,500)while LJ.CheckInterval(5)==0 do end;MB.W(2013,0,0)a=false;b=false;c=false;d=false;e=0;f=nil;while not m()do if n()then local a=h()local a=o(a)if a then LJ.IntervalConfig(5,500)while LJ.CheckInterval(5)==0 do end;g()s()break end end end;i(2008,0)i(2009,0)i(2013,0)LJ.IntervalConfig(4,2000)while LJ.CheckInterval(4)==0 do end;collectgarbage()end
